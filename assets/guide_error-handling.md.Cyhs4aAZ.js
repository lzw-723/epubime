import{_ as s,c as a,o as l,ah as n}from"./chunks/framework.BEBVyHNm.js";const g=JSON.parse('{"title":"错误处理系统","description":"","frontmatter":{},"headers":[],"relativePath":"guide/error-handling.md","filePath":"guide/error-handling.md"}'),t={name:"guide/error-handling.md"};function e(r,i,h,p,k,E){return l(),a("div",null,[...i[0]||(i[0]=[n(`<h1 id="错误处理系统" tabindex="-1">错误处理系统 <a class="header-anchor" href="#错误处理系统" aria-label="Permalink to “错误处理系统”">​</a></h1><h2 id="概述" tabindex="-1">概述 <a class="header-anchor" href="#概述" aria-label="Permalink to “概述”">​</a></h2><p>我们成功为EPUBime项目构建了一个全面的错误处理系统，提供了详细的错误信息、错误恢复机制和灵活的解析选项。</p><h2 id="核心组件" tabindex="-1">核心组件 <a class="header-anchor" href="#核心组件" aria-label="Permalink to “核心组件”">​</a></h2><h3 id="_1-增强的异常系统" tabindex="-1">1. 增强的异常系统 <a class="header-anchor" href="#_1-增强的异常系统" aria-label="Permalink to “1. 增强的异常系统”">​</a></h3><h4 id="epubparseexception-异常基类" tabindex="-1">EpubParseException（异常基类） <a class="header-anchor" href="#epubparseexception-异常基类" aria-label="Permalink to “EpubParseException（异常基类）”">​</a></h4><ul><li><p><strong>错误码系统</strong>：标准化的错误码（1000-9999范围）</p><ul><li>文件相关错误：1000-1999</li><li>ZIP相关错误：2000-2999</li><li>XML解析错误：3000-3999</li><li>EPUB格式错误：4000-4999</li><li>路径验证错误：5000-5999</li><li>资源相关错误：6000-6999</li><li>通用错误：9000-9999</li></ul></li><li><p><strong>详细上下文信息</strong>：</p><ul><li>文件名、文件路径、操作类型</li><li>行号、列号（XML解析）</li><li>自定义上下文数据</li><li>恢复建议</li></ul></li><li><p><strong>构建器模式</strong>：支持链式调用构建复杂异常</p></li></ul><h4 id="专用异常类" tabindex="-1">专用异常类 <a class="header-anchor" href="#专用异常类" aria-label="Permalink to “专用异常类”">​</a></h4><ul><li><strong>EpubZipException</strong>：ZIP文件处理异常</li><li><strong>EpubXmlParseException</strong>：XML解析异常，包含XPath和位置信息</li><li><strong>EpubFormatException</strong>：EPUB格式验证异常</li><li><strong>EpubPathValidationException</strong>：路径安全验证异常</li><li><strong>EpubResourceException</strong>：资源加载异常</li></ul><h3 id="_2-错误上下文收集器-errorcontext" tabindex="-1">2. 错误上下文收集器（ErrorContext） <a class="header-anchor" href="#_2-错误上下文收集器-errorcontext" aria-label="Permalink to “2. 错误上下文收集器（ErrorContext）”">​</a></h3><ul><li><strong>多级别错误记录</strong>：DEBUG、INFO、WARNING、ERROR、FATAL</li><li><strong>线程安全</strong>：使用CopyOnWriteArrayList和ConcurrentHashMap</li><li><strong>错误统计</strong>：详细的错误计数和分类</li><li><strong>错误报告生成</strong>：自动生成结构化的错误报告</li><li><strong>最大错误数限制</strong>：防止内存溢出</li><li><strong>全局上下文</strong>：支持添加全局元数据</li></ul><h3 id="_3-解析结果封装-parseresult" tabindex="-1">3. 解析结果封装（ParseResult） <a class="header-anchor" href="#_3-解析结果封装-parseresult" aria-label="Permalink to “3. 解析结果封装（ParseResult）”">​</a></h3><ul><li><strong>多状态支持</strong>：SUCCESS、PARTIAL_SUCCESS、RECOVERED、FAILURE</li><li><strong>性能指标</strong>：解析时间统计</li><li><strong>错误汇总</strong>：包含所有错误、警告和统计信息</li><li><strong>构建器模式</strong>：灵活的构建方式</li></ul><h3 id="_4-解析选项-parseoptions" tabindex="-1">4. 解析选项（ParseOptions） <a class="header-anchor" href="#_4-解析选项-parseoptions" aria-label="Permalink to “4. 解析选项（ParseOptions）”">​</a></h3><ul><li><p><strong>错误处理策略</strong>：</p><ul><li>STRICT：严格模式，任何错误都停止解析</li><li>LENIENT：宽松模式，可恢复错误继续解析</li><li>BEST_EFFORT：尽最大努力模式，尽可能解析更多内容</li></ul></li><li><p><strong>日志级别控制</strong>：DEBUG、INFO、WARNING、ERROR、NONE</p></li><li><p><strong>错误过滤</strong>：支持忽略特定模式的错误</p></li><li><p><strong>降级处理配置</strong>：针对不同错误类型的处理策略</p></li></ul><h3 id="_5-错误恢复配置-parseerrorconfig" tabindex="-1">5. 错误恢复配置（ParseErrorConfig） <a class="header-anchor" href="#_5-错误恢复配置-parseerrorconfig" aria-label="Permalink to “5. 错误恢复配置（ParseErrorConfig）”">​</a></h3><ul><li><strong>错误处理策略</strong>：STRICT、LENIENT、BEST_EFFORT</li><li><strong>严重级别阈值</strong>：控制哪些级别的错误会导致解析失败</li><li><strong>最大错误数限制</strong>：防止过多错误影响性能</li><li><strong>降级处理</strong>：支持跳过无效资源等降级策略</li></ul><h2 id="关键特性" tabindex="-1">关键特性 <a class="header-anchor" href="#关键特性" aria-label="Permalink to “关键特性”">​</a></h2><h3 id="_1-详细的错误信息" tabindex="-1">1. 详细的错误信息 <a class="header-anchor" href="#_1-详细的错误信息" aria-label="Permalink to “1. 详细的错误信息”">​</a></h3><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>[3001: XML parsing failed] Invalid XML structure [File: content.opf, Path: OEBPS/content.opf, Operation: xmlParsing]</span></span></code></pre></div><h3 id="_2-错误恢复机制" tabindex="-1">2. 错误恢复机制 <a class="header-anchor" href="#_2-错误恢复机制" aria-label="Permalink to “2. 错误恢复机制”">​</a></h3><ul><li>自动恢复：对于非致命错误，系统可以尝试继续解析</li><li>降级处理：跳过无效部分，解析有效内容</li><li>配置灵活：通过ParseOptions控制恢复行为</li></ul><h3 id="_3-性能优化" tabindex="-1">3. 性能优化 <a class="header-anchor" href="#_3-性能优化" aria-label="Permalink to “3. 性能优化”">​</a></h3><ul><li>缓存机制：避免重复解析相同文件</li><li>快速失败：严重错误立即终止，节省资源</li><li>统计信息：提供详细的性能指标</li></ul><h3 id="_4-安全性增强" tabindex="-1">4. 安全性增强 <a class="header-anchor" href="#_4-安全性增强" aria-label="Permalink to “4. 安全性增强”">​</a></h3><ul><li>路径遍历攻击检测</li><li>恶意文件格式验证</li><li>资源访问权限检查</li></ul><h2 id="使用示例" tabindex="-1">使用示例 <a class="header-anchor" href="#使用示例" aria-label="Permalink to “使用示例”">​</a></h2><h3 id="基本异常创建" tabindex="-1">基本异常创建 <a class="header-anchor" href="#基本异常创建" aria-label="Permalink to “基本异常创建”">​</a></h3><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">EpubParseException exception </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> EpubParseException.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Builder</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">message</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;XML解析失败&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">fileName</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;content.opf&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">filePath</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;OEBPS/content.opf&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">operation</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;xmlParsing&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">errorCode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(EpubParseException.ErrorCode.XML_PARSE_ERROR)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">lineNumber</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">15</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">columnNumber</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">20</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">addContext</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;xpath&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/package/metadata&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">build</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span></code></pre></div><h3 id="错误上下文使用" tabindex="-1">错误上下文使用 <a class="header-anchor" href="#错误上下文使用" aria-label="Permalink to “错误上下文使用”">​</a></h3><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ErrorContext errorContext </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ErrorContext</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">100</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, ParseOptions.LogLevel.DEBUG);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">errorContext.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">warning</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;缺少可选元数据&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;book.epub&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/metadata&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;metadataParsing&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                    EpubParseException.ErrorCode.XML_MISSING_REQUIRED_ELEMENT, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><h3 id="解析结果处理" tabindex="-1">解析结果处理 <a class="header-anchor" href="#解析结果处理" aria-label="Permalink to “解析结果处理”">​</a></h3><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ParseResult result </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ParseResult.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">partialSuccess</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(epubBook, errorContext, parseTime);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (result.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">isPartialSuccess</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    System.out.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;解析部分成功，有警告信息&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    System.out.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(result.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getErrorStatistics</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h2 id="性能指标" tabindex="-1">性能指标 <a class="header-anchor" href="#性能指标" aria-label="Permalink to “性能指标”">​</a></h2><ul><li><strong>缓存效率</strong>：99.5%+ 的性能提升</li><li><strong>解析速度</strong>：平均6-10ms完成EPUB解析</li><li><strong>内存使用</strong>：优化的错误收集，防止内存泄漏</li><li><strong>并发安全</strong>：线程安全的错误收集机制</li></ul><h2 id="质量保证" tabindex="-1">质量保证 <a class="header-anchor" href="#质量保证" aria-label="Permalink to “质量保证”">​</a></h2><ul><li><strong>测试覆盖率</strong>：111个测试用例，全部通过</li><li><strong>代码质量</strong>：SpotBugs静态分析通过</li><li><strong>性能基准</strong>：集成JMH专业基准测试，与epublib对比解析性能提升55%</li><li><strong>文档完整</strong>：详细的JavaDoc和示例代码</li></ul><h2 id="总结" tabindex="-1">总结 <a class="header-anchor" href="#总结" aria-label="Permalink to “总结”">​</a></h2><p>这个增强的错误处理系统为EPUBime提供了：</p><ol><li><strong>企业级的错误处理能力</strong>：详细的错误信息和恢复机制</li><li><strong>灵活的配置选项</strong>：适应不同的使用场景</li><li><strong>优秀的性能表现</strong>：缓存机制和优化策略</li><li><strong>完善的监控能力</strong>：详细的统计和报告功能</li><li><strong>强大的安全性</strong>：路径验证和恶意文件检测</li></ol><p>系统现在能够优雅地处理各种EPUB解析错误，提供有用的错误信息，并在可能的情况下自动恢复，大大提升了用户体验和系统稳定性。</p>`,41)])])}const d=s(t,[["render",e]]);export{g as __pageData,d as default};
